

library(spotifyr)
library(tidyverse)

Sys.setenv(SPOTIFY_CLIENT_ID = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx')
Sys.setenv(SPOTIFY_CLIENT_SECRET = 'xxxxxxxxxxxxxxxxxxxxxxxxxx')

access_token <- get_spotify_access_token()

access_token

#buscamos al artista

kidpudu <- search_spotify("Kid Voodoo", type = "artist")
kidpudu$id

artist_id <- "10VBp06W8NIgMW4JruLCC4"
#Obtenemos las canciones del artista más populares
top_tracks <- get_artist_top_tracks(artist_id)
head(top_tracks)

df_kidpudu <- top_tracks |> 
select(explicit, name, popularity)

df_kidpudu |> 
  ggplot(aes(x = fct_reorder(name, popularity), y = popularity, fill = explicit)) +
  annotation_custom(g, xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
  geom_col(alpha = 0.5) +
  scale_fill_manual(values = c("TRUE" = "#f8f9fa", "FALSE" = "#6c757d"),
                    label = c("Sí", "No"),
                    name = "¿Es o no explícita?") +
  scale_y_continuous(limits = c(0,100)) +
  coord_flip() +
  labs(
    title = "Si estás viendo esto, significa que ya
    escuchaste todas las canciones atrás en el disco",
    subtitle = "Canciones de Kidvoodoo según popularidad en Spotify",
    x = "Nombre de canción",
    y = "Popularidad (0-100)",
    caption = "Fuente: API de Spotify"
  )+
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"),
        plot.subtitle = element_text(hjust = 0.5))+
  theme(
    plot.title = element_text(family = "Stencil", size = 14, face = "bold", hjust = 0.5, color = "w hite"),
    plot.subtitle = element_text(family = "Segoe UI", size = 10, hjust = 0.5, color = "white"),
    axis.title = element_text(family = "Segoe UI", size = 10, color = "white"),
    axis.text = element_text(family = "Segoe UI", size = 10, color = "#adb5bd"),
    legend.title = element_text(family = "Segoe UI", size = 10, color = "white"),
    legend.text = element_text(family = "Segoe UI", size = 10, color = "white"),
    legend.position = "bottom",
    plot.background = element_rect(fill = "#202020", color = NA)
  ))

img <- readJPEG("imagen de kidd.jpg")
g <- rasterGrob(img, width = unit(1,"npc"), height = unit(1,"npc"))
